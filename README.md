# Raspberry Pi モーター制御 Web アプリケーション

このプロジェクトは、Raspberry Piに接続されたモーターをブラウザから制御するためのWebアプリケーションです。FlaskとWebSocketを使用してリアルタイムな制御を実現し、pigpioライブラリを使用してGPIOを制御します。

## 機能

- **Webブラウザからのモーター制御**: 直感的なUI
- **リアルタイム通信**: WebSocketを使用した低遅延制御
- **速度調整**: 0-100%の範囲で速度を調整可能
- **継続時間設定**: 指定した時間だけモーターを動作
- **キーボード操作**: WASD/矢印キーでの操作も可能
- **モバイル対応**: タッチデバイスでも操作可能

## 必要な機器

- Raspberry Pi (3B+/4推奨)
- L298Nモータードライバー
- DCモーター 2個
- ジャンパーワイヤー

## 配線

### モーターA (左側)
- ENA (PWM) → GPIO 10
- IN1 → GPIO 26
- IN2 → GPIO 16

### モーターB (右側)
- ENB (PWM) → GPIO 9
- IN3 → GPIO 7
- IN4 → GPIO 8

## インストール

1. **必要なパッケージのインストール**:
```bash
pip install flask flask-socketio pigpio
```

2. **pigpioデーモンの起動**:
```bash
sudo pigpiod
```

## 使用方法

1. **アプリケーションの起動**:
```bash
python app.py
```

2. **ブラウザでアクセス**:
   - `http://localhost:5000` または
   - `http://[RaspberryPiのIPアドレス]:5000`

## 操作方法

### ブラウザでの操作
- **前進/後進/左旋回/右旋回**: 対応するボタンをクリック
- **停止**: 赤い停止ボタンをクリック
- **速度調整**: スライダーで0-100%の範囲で調整
- **継続時間**: 指定秒数だけ動作（0=無制限）

### キーボード操作
- `W` / `↑`: 前進
- `S` / `↓`: 後進
- `A` / `←`: 左旋回
- `D` / `→`: 右旋回
- `Space` / `Esc`: 停止

## プロジェクト構造

```
rpicontest/
├── app.py              # メインのFlaskアプリケーション
├── motor_test.py       # RPi.GPIOを使用した旧テストファイル
├── templates/
│   └── index.html      # Webインターフェース
└── README.md           # このファイル
```

## 主な特徴

### pigpioの使用
- より高精度なPWM制御
- より安定したGPIO操作
- CPUリソースの効率的な使用

### WebSocket通信
- リアルタイムな制御
- 双方向通信によるステータス表示
- 接続状態の監視

### 安全機能
- 継続時間設定による自動停止
- クライアント切断時の自動停止
- エラーハンドリング

## トラブルシューティング

### pigpioデーモンが起動しない
```bash
sudo killall pigpiod
sudo pigpiod
```

### 権限エラー
```bash
sudo usermod -a -G gpio $USER
# 再ログインが必要
```

### モーターが動作しない
1. 配線を確認
2. 電源供給を確認
3. L298Nの電源LEDを確認

## 注意事項

- 必ずpigpioデーモンを起動してからアプリケーションを実行してください
- プログラム終了時は自動的にGPIOがクリーンアップされます
- モーターの電源とRaspberry Piの電源は別々に供給することを推奨します

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。
