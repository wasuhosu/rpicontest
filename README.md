# Raspberry Pi モーター制御 & カメラサーボ制御 Web アプリケーション

このプロジェクトは、R```bash
pip install flask flask-socketio pigpio rpi-ws281x
```

2. **pigpioデーモンの起動**:
```bash
sudo pigpiod
```

## 使用方法

1. **アプリケーションの起動**（管理者権限が必要）:
```bash
sudo python app.py
```れたモーターとカメラ用サーボモーターをブラウザから制御するためのWebアプリケーションです。FlaskとWebSocketを使用してリアルタイムな制御を実現し、pigpioライブラリを使用してGPIOを制御します。

## 機能

### モーター制御
- **Webブラウザからのモーター制御**: 直感的なUI
- **リアルタイム通信**: WebSocketを使用した低遅延制御
- **速度調整**: 0-100%の範囲で速度を調整可能
- **押している間だけ動作**: ボタンやキーを離すと自動停止

### カメラサーボ制御
- **ピッチ制御**: カメラの上下角度調整
- **ヨー制御**: カメラの左右角度調整
- **角度表示**: 現在の角度をリアルタイム表示
- **中央復帰**: ワンクリックで中央位置に復帰

### その他の機能
- **キーボード操作**: WASD/矢印キーでの操作も可能
- **モバイル対応**: タッチデバイスでも操作可能

## 必要な機器

- Raspberry Pi (3B+/4推奨)
- L298Nモータードライバー
- DCモーター 2個
- サーボモーター 2個（SG90推奨）
- フルカラーテープLED 6個（WS2812B/NeoPixel）
- ジャンパーワイヤー

## 配線

### モーターA (左側)
- ENA (PWM) → GPIO 10
- IN1 → GPIO 26
- IN2 → GPIO 16

### モーターB (右側)
- ENB (PWM) → GPIO 9
- IN3 → GPIO 7
- IN4 → GPIO 8

### サーボモーター
- ピッチサーボ（上下制御） → GPIO 18
- ヨーサーボ（左右制御） → GPIO 13
- 両サーボとも5V電源とGNDに接続

### フルカラーLED（WS2812B）
- データピン → GPIO 12
- 5V電源とGNDに接続
- LED数：6個

## インストール

1. **必要なパッケージのインストール**:
```bash
pip install flask flask-socketio pigpio rpi-ws281x
```bash
pip install flask flask-socketio pigpio
```

2. **pigpioデーモンの起動**:
```bash
sudo pigpiod
```

## 使用方法

1. **アプリケーションの起動**:
```bash
python app.py
```

2. **ブラウザでアクセス**:
   - `http://localhost:5000` または
   - `http://[RaspberryPiのIPアドレス]:5000`

## 操作方法

### ブラウザでの操作

#### モーター制御
- **前進/後進/左旋回/右旋回**: 対応するボタンを押している間動作
- **速度調整**: スライダーで0-100%の範囲で調整

#### カメラサーボ制御
- **ピッチ制御**: 「上」「下」ボタンでカメラの上下角度を調整
- **ヨー制御**: 「左」「右」ボタンでカメラの左右角度を調整
- **中央復帰**: 「中央」ボタンで90度（中央位置）に復帰
- **スライダー制御**: スライダーを動かして直接角度を指定（0-180度）
- **リアルタイム表示**: 現在の角度をリアルタイムで表示

#### フルカラーLED制御
- **LED選択**: LED番号（1-6）をクリックで個別選択、再クリックで全LED選択
- **色設定**: カラーピッカーまたはRGBスライダーで色を選択
- **明度調整**: スライダーで0-100%の範囲で明度を調整
- **色適用**: 「選択色を適用」ボタンで選択したLEDに色を設定
- **アニメーション**: 
  - 「レインボー」: 虹色のグラデーションアニメーション
  - 「チェイス」: 選択色で順次点灯するアニメーション
- **消灯**: 「消灯」ボタンで全LEDを消灯

### キーボード操作

#### モーター制御
- `W` / `↑`: 前進
- `S` / `↓`: 後進
- `A` / `←`: 左旋回
- `D` / `→`: 右旋回

#### カメラサーボ制御
- `I`: ピッチ上（カメラを上に）
- `K`: ピッチ下（カメラを下に）
- `J`: ヨー左（カメラを左に）
- `L`: ヨー右（カメラを右に）
- `C`: 両軸を中央位置に復帰

## プロジェクト構造

```
rpicontest/
├── app.py              # メインのFlaskアプリケーション
├── motor_test.py       # RPi.GPIOを使用した旧テストファイル
├── templates/
│   └── index.html      # Webインターフェース
└── README.md           # このファイル
```

## 主な特徴

### pigpioの使用
- より高精度なPWM制御
- より安定したGPIO操作
- CPUリソースの効率的な使用
- サーボモーターの精密制御

### WebSocket通信
- リアルタイムな制御
- 双方向通信によるステータス表示
- 接続状態の監視
- サーボ角度のリアルタイム表示

### 安全機能
- ボタンを離すと自動停止
- クライアント切断時の自動停止
- ページフォーカス失時の自動停止
- エラーハンドリング
- 終了時のサーボ中央復帰

## トラブルシューティング

### pigpioデーモンが起動しない
```bash
sudo killall pigpiod
sudo pigpiod
```

### 権限エラー
```bash
sudo usermod -a -G gpio $USER
# 再ログインが必要
```

### モーターが動作しない
1. 配線を確認
2. 電源供給を確認
3. L298Nの電源LEDを確認

## 注意事項

- 必ずpigpioデーモンを起動してからアプリケーションを実行してください
- プログラム終了時は自動的にGPIOがクリーンアップされます
- モーターの電源とRaspberry Piの電源は別々に供給することを推奨します

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。
